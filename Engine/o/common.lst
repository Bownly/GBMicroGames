                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ANSI-C Compiler
                                      3 ; Version 4.1.6 #12539 (MINGW32)
                                      4 ;--------------------------------------------------------
                                      5 	.module common
                                      6 	.optsdcc -mgbz80
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _printLine
                                     12 	.globl _drawPopupWindow
                                     13 	.globl _getRandUint8
                                     14 	.globl _rand
                                     15 	.globl _set_win_tiles
                                     16 	.globl _set_bkg_tile_xy
                                     17 	.globl _set_bkg_tiles
                                     18 ;--------------------------------------------------------
                                     19 ; special function registers
                                     20 ;--------------------------------------------------------
                                     21 ;--------------------------------------------------------
                                     22 ; ram data
                                     23 ;--------------------------------------------------------
                                     24 	.area _DATA
                                     25 ;--------------------------------------------------------
                                     26 ; ram data
                                     27 ;--------------------------------------------------------
                                     28 	.area _INITIALIZED
                                     29 ;--------------------------------------------------------
                                     30 ; absolute external ram data
                                     31 ;--------------------------------------------------------
                                     32 	.area _DABS (ABS)
                                     33 ;--------------------------------------------------------
                                     34 ; global & static initialisations
                                     35 ;--------------------------------------------------------
                                     36 	.area _HOME
                                     37 	.area _GSINIT
                                     38 	.area _GSFINAL
                                     39 	.area _GSINIT
                                     40 ;--------------------------------------------------------
                                     41 ; Home
                                     42 ;--------------------------------------------------------
                                     43 	.area _HOME
                                     44 	.area _HOME
                                     45 ;--------------------------------------------------------
                                     46 ; code
                                     47 ;--------------------------------------------------------
                                     48 	.area _CODE
                                     49 ;Engine/common.c:9: UINT8 getRandUint8(UINT8 modulo)
                                     50 ;	---------------------------------
                                     51 ; Function getRandUint8
                                     52 ; ---------------------------------
      000000                         53 _getRandUint8::
                                     54 ;Engine/common.c:11: r = rand() % modulo;
      000000 CDr00r00                55 	call	_rand
      000003 7B                      56 	ld	a, e
      000004 F8 02                   57 	ldhl	sp,	#2
      000006 66                      58 	ld	h, (hl)
                                     59 ;	spillPairReg hl
                                     60 ;	spillPairReg hl
      000007 E5                      61 	push	hl
      000008 33                      62 	inc	sp
      000009 F5                      63 	push	af
      00000A 33                      64 	inc	sp
      00000B CDr00r00                65 	call	__moduchar
      00000E E1                      66 	pop	hl
      00000F 21r00r00                67 	ld	hl, #_r
                                     68 ;Engine/common.c:12: return r;
      000012 73                      69 	ld	(hl),e
                                     70 ;Engine/common.c:13: }
      000013 C9                      71 	ret
                                     72 ;Engine/common.c:15: void drawPopupWindow(UINT8 xCoord, UINT8 yCoord, UINT8 xDim, UINT8 yDim)
                                     73 ;	---------------------------------
                                     74 ; Function drawPopupWindow
                                     75 ; ---------------------------------
      000014                         76 _drawPopupWindow::
                                     77 ;Engine/common.c:18: set_bkg_tile_xy(xCoord, yCoord, 0xF0U);
      000014 3E F0                   78 	ld	a, #0xf0
      000016 F5                      79 	push	af
      000017 33                      80 	inc	sp
      000018 F8 04                   81 	ldhl	sp,	#4
      00001A 3A                      82 	ld	a, (hl-)
      00001B 57                      83 	ld	d, a
      00001C 5E                      84 	ld	e, (hl)
      00001D D5                      85 	push	de
      00001E CDr00r00                86 	call	_set_bkg_tile_xy
      000021 E8 03                   87 	add	sp, #3
                                     88 ;Engine/common.c:19: set_bkg_tile_xy(xCoord + xDim, yCoord, 0xF2U);
      000023 F8 02                   89 	ldhl	sp,	#2
      000025 2A                      90 	ld	a, (hl+)
      000026 23                      91 	inc	hl
      000027 86                      92 	add	a, (hl)
      000028 2B                      93 	dec	hl
      000029 4F                      94 	ld	c, a
      00002A 3E F2                   95 	ld	a, #0xf2
      00002C F5                      96 	push	af
      00002D 33                      97 	inc	sp
      00002E 46                      98 	ld	b, (hl)
      00002F C5                      99 	push	bc
      000030 CDr00r00               100 	call	_set_bkg_tile_xy
      000033 E8 03                  101 	add	sp, #3
                                    102 ;Engine/common.c:20: set_bkg_tile_xy(xCoord, yCoord + yDim, 0xF5U);
      000035 F8 03                  103 	ldhl	sp,	#3
      000037 2A                     104 	ld	a, (hl+)
      000038 23                     105 	inc	hl
      000039 86                     106 	add	a, (hl)
      00003A 47                     107 	ld	b, a
      00003B 3E F5                  108 	ld	a, #0xf5
      00003D F5                     109 	push	af
      00003E 33                     110 	inc	sp
      00003F C5                     111 	push	bc
      000040 33                     112 	inc	sp
      000041 F8 04                  113 	ldhl	sp,	#4
      000043 7E                     114 	ld	a, (hl)
      000044 F5                     115 	push	af
      000045 33                     116 	inc	sp
      000046 CDr00r00               117 	call	_set_bkg_tile_xy
      000049 E8 03                  118 	add	sp, #3
                                    119 ;Engine/common.c:21: set_bkg_tile_xy(xCoord + xDim, yCoord + yDim, 0xF7U);
      00004B 3E F7                  120 	ld	a, #0xf7
      00004D F5                     121 	push	af
      00004E 33                     122 	inc	sp
      00004F C5                     123 	push	bc
      000050 33                     124 	inc	sp
      000051 79                     125 	ld	a, c
      000052 F5                     126 	push	af
      000053 33                     127 	inc	sp
      000054 CDr00r00               128 	call	_set_bkg_tile_xy
      000057 E8 03                  129 	add	sp, #3
                                    130 ;Engine/common.c:24: for (i = 1U; i != xDim; ++i)
      000059 21r00r00               131 	ld	hl, #_i
      00005C 36 01                  132 	ld	(hl), #0x01
      00005E                        133 00108$:
      00005E FAr00r00               134 	ld	a, (#_i)
      000061 F8 04                  135 	ldhl	sp,	#4
      000063 96                     136 	sub	a, (hl)
      000064 28 5C                  137 	jr	Z, 00102$
                                    138 ;Engine/common.c:26: set_bkg_tile_xy(xCoord + i, yCoord, 0xF1U);
      000066 F8 02                  139 	ldhl	sp,	#2
      000068 7E                     140 	ld	a, (hl)
      000069 21r00r00               141 	ld	hl, #_i
      00006C 86                     142 	add	a, (hl)
      00006D 26 F1                  143 	ld	h, #0xf1
                                    144 ;	spillPairReg hl
                                    145 ;	spillPairReg hl
      00006F E5                     146 	push	hl
      000070 33                     147 	inc	sp
      000071 F8 04                  148 	ldhl	sp,	#4
      000073 66                     149 	ld	h, (hl)
                                    150 ;	spillPairReg hl
                                    151 ;	spillPairReg hl
      000074 E5                     152 	push	hl
      000075 33                     153 	inc	sp
      000076 F5                     154 	push	af
      000077 33                     155 	inc	sp
      000078 CDr00r00               156 	call	_set_bkg_tile_xy
      00007B E8 03                  157 	add	sp, #3
                                    158 ;Engine/common.c:27: set_bkg_tile_xy(xCoord + i, yCoord + yDim, 0xF6U);
      00007D F8 02                  159 	ldhl	sp,	#2
      00007F 7E                     160 	ld	a, (hl)
      000080 21r00r00               161 	ld	hl, #_i
      000083 86                     162 	add	a, (hl)
      000084 26 F6                  163 	ld	h, #0xf6
                                    164 ;	spillPairReg hl
                                    165 ;	spillPairReg hl
      000086 68                     166 	ld	l, b
      000087 E5                     167 	push	hl
      000088 F5                     168 	push	af
      000089 33                     169 	inc	sp
      00008A CDr00r00               170 	call	_set_bkg_tile_xy
      00008D E8 03                  171 	add	sp, #3
                                    172 ;Engine/common.c:30: for (j = 1U; j != yDim; j++)
      00008F 21r00r00               173 	ld	hl, #_j
      000092 36 01                  174 	ld	(hl), #0x01
      000094                        175 00105$:
      000094 FAr00r00               176 	ld	a, (#_j)
      000097 F8 05                  177 	ldhl	sp,	#5
      000099 96                     178 	sub	a, (hl)
      00009A 28 20                  179 	jr	Z, 00109$
                                    180 ;Engine/common.c:32: set_bkg_tile_xy(xCoord + i, yCoord + j, 0xF8U);
      00009C F8 03                  181 	ldhl	sp,	#3
      00009E 7E                     182 	ld	a, (hl)
      00009F 21r00r00               183 	ld	hl, #_j
      0000A2 86                     184 	add	a, (hl)
      0000A3 57                     185 	ld	d, a
      0000A4 F8 02                  186 	ldhl	sp,	#2
      0000A6 7E                     187 	ld	a, (hl)
      0000A7 21r00r00               188 	ld	hl, #_i
      0000AA 86                     189 	add	a, (hl)
      0000AB 26 F8                  190 	ld	h, #0xf8
                                    191 ;	spillPairReg hl
                                    192 ;	spillPairReg hl
      0000AD 6A                     193 	ld	l, d
      0000AE E5                     194 	push	hl
      0000AF F5                     195 	push	af
      0000B0 33                     196 	inc	sp
      0000B1 CDr00r00               197 	call	_set_bkg_tile_xy
      0000B4 E8 03                  198 	add	sp, #3
                                    199 ;Engine/common.c:30: for (j = 1U; j != yDim; j++)
      0000B6 21r00r00               200 	ld	hl, #_j
      0000B9 34                     201 	inc	(hl)
      0000BA 18 D8                  202 	jr	00105$
      0000BC                        203 00109$:
                                    204 ;Engine/common.c:24: for (i = 1U; i != xDim; ++i)
      0000BC 21r00r00               205 	ld	hl, #_i
      0000BF 34                     206 	inc	(hl)
      0000C0 18 9C                  207 	jr	00108$
      0000C2                        208 00102$:
                                    209 ;Engine/common.c:35: for (j = 1U; j != yDim; ++j)
      0000C2 21r00r00               210 	ld	hl, #_j
      0000C5 36 01                  211 	ld	(hl), #0x01
      0000C7                        212 00111$:
      0000C7 FAr00r00               213 	ld	a, (#_j)
      0000CA F8 05                  214 	ldhl	sp,	#5
      0000CC 96                     215 	sub	a, (hl)
      0000CD C8                     216 	ret	Z
                                    217 ;Engine/common.c:37: set_bkg_tile_xy(xCoord, yCoord + j, 0xF3U);
      0000CE F8 03                  218 	ldhl	sp,	#3
      0000D0 7E                     219 	ld	a, (hl)
      0000D1 21r00r00               220 	ld	hl, #_j
      0000D4 86                     221 	add	a, (hl)
      0000D5 26 F3                  222 	ld	h, #0xf3
                                    223 ;	spillPairReg hl
                                    224 ;	spillPairReg hl
      0000D7 E5                     225 	push	hl
      0000D8 33                     226 	inc	sp
      0000D9 F5                     227 	push	af
      0000DA 33                     228 	inc	sp
      0000DB F8 04                  229 	ldhl	sp,	#4
      0000DD 7E                     230 	ld	a, (hl)
      0000DE F5                     231 	push	af
      0000DF 33                     232 	inc	sp
      0000E0 CDr00r00               233 	call	_set_bkg_tile_xy
      0000E3 E8 03                  234 	add	sp, #3
                                    235 ;Engine/common.c:38: set_bkg_tile_xy(xCoord + xDim, yCoord + j, 0xF4U);
      0000E5 F8 03                  236 	ldhl	sp,	#3
      0000E7 7E                     237 	ld	a, (hl)
      0000E8 21r00r00               238 	ld	hl, #_j
      0000EB 86                     239 	add	a, (hl)
      0000EC 26 F4                  240 	ld	h, #0xf4
                                    241 ;	spillPairReg hl
                                    242 ;	spillPairReg hl
      0000EE E5                     243 	push	hl
      0000EF 33                     244 	inc	sp
      0000F0 47                     245 	ld	b, a
      0000F1 C5                     246 	push	bc
      0000F2 CDr00r00               247 	call	_set_bkg_tile_xy
      0000F5 E8 03                  248 	add	sp, #3
                                    249 ;Engine/common.c:35: for (j = 1U; j != yDim; ++j)
      0000F7 21r00r00               250 	ld	hl, #_j
      0000FA 34                     251 	inc	(hl)
                                    252 ;Engine/common.c:40: }
      0000FB 18 CA                  253 	jr	00111$
                                    254 ;Engine/common.c:43: void printLine(UINT8 xCoord, UINT8 yCoord, unsigned char* line, UINT8 printToWindow)
                                    255 ;	---------------------------------
                                    256 ; Function printLine
                                    257 ; ---------------------------------
      0000FD                        258 _printLine::
      0000FD E8 ED                  259 	add	sp, #-19
                                    260 ;Engine/common.c:46: unsigned char* tempLinePtr = tempLine;
      0000FF F8 00                  261 	ldhl	sp,	#0
      000101 4D                     262 	ld	c, l
      000102 44                     263 	ld	b, h
                                    264 ;Engine/common.c:49: while (*line)
      000103 F8 17                  265 	ldhl	sp,	#23
      000105 2A                     266 	ld	a, (hl+)
      000106 5F                     267 	ld	e, a
      000107 56                     268 	ld	d, (hl)
      000108 F8 12                  269 	ldhl	sp,	#18
      00010A 36 00                  270 	ld	(hl), #0x00
      00010C                        271 00122$:
      00010C 1A                     272 	ld	a, (de)
                                    273 ;	spillPairReg hl
                                    274 ;	spillPairReg hl
                                    275 ;Engine/common.c:51: if (*line == ' ')
      00010D 6F                     276 	ld	l,a
      00010E B7                     277 	or	a,a
      00010F 28 4A                  278 	jr	Z, 00124$
      000111 D6 20                  279 	sub	a, #0x20
      000113 20 04                  280 	jr	NZ, 00120$
                                    281 ;Engine/common.c:52: diff = 0x21;
      000115 26 21                  282 	ld	h, #0x21
                                    283 ;	spillPairReg hl
                                    284 ;	spillPairReg hl
      000117 18 38                  285 	jr	00121$
      000119                        286 00120$:
                                    287 ;Engine/common.c:53: else if (*line == '.')
      000119 7D                     288 	ld	a, l
      00011A D6 2E                  289 	sub	a, #0x2e
      00011C 20 04                  290 	jr	NZ, 00117$
                                    291 ;Engine/common.c:54: diff = 0x0A;
      00011E 26 0A                  292 	ld	h, #0x0a
                                    293 ;	spillPairReg hl
                                    294 ;	spillPairReg hl
      000120 18 2F                  295 	jr	00121$
      000122                        296 00117$:
                                    297 ;Engine/common.c:55: else if (*line == ',')
      000122 7D                     298 	ld	a, l
      000123 D6 2C                  299 	sub	a, #0x2c
      000125 20 04                  300 	jr	NZ, 00114$
                                    301 ;Engine/common.c:56: diff = 0x06;
      000127 26 06                  302 	ld	h, #0x06
                                    303 ;	spillPairReg hl
                                    304 ;	spillPairReg hl
      000129 18 26                  305 	jr	00121$
      00012B                        306 00114$:
                                    307 ;Engine/common.c:57: else if (*line == '?')
      00012B 7D                     308 	ld	a, l
      00012C D6 3F                  309 	sub	a, #0x3f
      00012E 20 04                  310 	jr	NZ, 00111$
                                    311 ;Engine/common.c:58: diff = 0x1A;
      000130 26 1A                  312 	ld	h, #0x1a
                                    313 ;	spillPairReg hl
                                    314 ;	spillPairReg hl
      000132 18 1D                  315 	jr	00121$
      000134                        316 00111$:
                                    317 ;Engine/common.c:59: else if (*line == ':')
      000134 7D                     318 	ld	a, l
      000135 D6 3A                  319 	sub	a, #0x3a
      000137 20 04                  320 	jr	NZ, 00108$
                                    321 ;Engine/common.c:60: diff = 0x0F;
      000139 26 0F                  322 	ld	h, #0x0f
                                    323 ;	spillPairReg hl
                                    324 ;	spillPairReg hl
      00013B 18 14                  325 	jr	00121$
      00013D                        326 00108$:
                                    327 ;Engine/common.c:61: else if (*line == '!')
      00013D 7D                     328 	ld	a, l
      00013E D6 21                  329 	sub	a, #0x21
      000140 20 04                  330 	jr	NZ, 00105$
                                    331 ;Engine/common.c:62: diff = 0xF9;
      000142 26 F9                  332 	ld	h, #0xf9
                                    333 ;	spillPairReg hl
                                    334 ;	spillPairReg hl
      000144 18 0B                  335 	jr	00121$
      000146                        336 00105$:
                                    337 ;Engine/common.c:63: else if (*line <= 0x39)  // 0-9... and anything lower in index than 0
      000146 3E 39                  338 	ld	a, #0x39
      000148 95                     339 	sub	a, l
      000149 38 04                  340 	jr	C, 00102$
                                    341 ;Engine/common.c:64: diff = 0x30;
      00014B 26 30                  342 	ld	h, #0x30
                                    343 ;	spillPairReg hl
                                    344 ;	spillPairReg hl
      00014D 18 02                  345 	jr	00121$
      00014F                        346 00102$:
                                    347 ;Engine/common.c:66: diff = 0x37;
      00014F 26 37                  348 	ld	h, #0x37
                                    349 ;	spillPairReg hl
                                    350 ;	spillPairReg hl
      000151                        351 00121$:
                                    352 ;Engine/common.c:68: *tempLinePtr = *line - diff;
      000151 7D                     353 	ld	a, l
      000152 94                     354 	sub	a, h
      000153 02                     355 	ld	(bc), a
                                    356 ;Engine/common.c:69: tempLinePtr++;
      000154 03                     357 	inc	bc
                                    358 ;Engine/common.c:70: line++;
      000155 13                     359 	inc	de
                                    360 ;Engine/common.c:71: size++;
      000156 F8 12                  361 	ldhl	sp,	#18
      000158 34                     362 	inc	(hl)
      000159 18 B1                  363 	jr	00122$
      00015B                        364 00124$:
                                    365 ;Engine/common.c:75: set_bkg_tiles(xCoord, yCoord, size, 1U, tempLinePtr-size);
      00015B F8 12                  366 	ldhl	sp,	#18
      00015D 5E                     367 	ld	e, (hl)
      00015E 16 00                  368 	ld	d, #0x00
      000160 79                     369 	ld	a, c
      000161 93                     370 	sub	a, e
      000162 4F                     371 	ld	c, a
      000163 78                     372 	ld	a, b
      000164 9A                     373 	sbc	a, d
      000165 47                     374 	ld	b, a
                                    375 ;Engine/common.c:74: if (printToWindow == FALSE)
      000166 F8 19                  376 	ldhl	sp,	#25
      000168 7E                     377 	ld	a, (hl)
      000169 B7                     378 	or	a, a
      00016A 20 17                  379 	jr	NZ, 00126$
                                    380 ;Engine/common.c:75: set_bkg_tiles(xCoord, yCoord, size, 1U, tempLinePtr-size);
      00016C C5                     381 	push	bc
      00016D 3E 01                  382 	ld	a, #0x01
      00016F F5                     383 	push	af
      000170 33                     384 	inc	sp
      000171 F8 15                  385 	ldhl	sp,	#21
      000173 7E                     386 	ld	a, (hl)
      000174 F5                     387 	push	af
      000175 33                     388 	inc	sp
      000176 F8 1A                  389 	ldhl	sp,	#26
      000178 3A                     390 	ld	a, (hl-)
      000179 57                     391 	ld	d, a
      00017A 5E                     392 	ld	e, (hl)
      00017B D5                     393 	push	de
      00017C CDr00r00               394 	call	_set_bkg_tiles
      00017F E8 06                  395 	add	sp, #6
      000181 18 15                  396 	jr	00128$
      000183                        397 00126$:
                                    398 ;Engine/common.c:77: set_win_tiles(xCoord, yCoord, size, 1U, tempLinePtr-size);
      000183 C5                     399 	push	bc
      000184 3E 01                  400 	ld	a, #0x01
      000186 F5                     401 	push	af
      000187 33                     402 	inc	sp
      000188 F8 15                  403 	ldhl	sp,	#21
      00018A 7E                     404 	ld	a, (hl)
      00018B F5                     405 	push	af
      00018C 33                     406 	inc	sp
      00018D F8 1A                  407 	ldhl	sp,	#26
      00018F 3A                     408 	ld	a, (hl-)
      000190 57                     409 	ld	d, a
      000191 5E                     410 	ld	e, (hl)
      000192 D5                     411 	push	de
      000193 CDr00r00               412 	call	_set_win_tiles
      000196 E8 06                  413 	add	sp, #6
      000198                        414 00128$:
                                    415 ;Engine/common.c:78: }
      000198 E8 13                  416 	add	sp, #19
      00019A C9                     417 	ret
                                    418 	.area _CODE
                                    419 	.area _INITIALIZER
                                    420 	.area _CABS (ABS)
